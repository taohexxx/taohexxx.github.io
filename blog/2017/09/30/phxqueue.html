<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>PhxQueue · Tao He</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="{% include JB/setup %}"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="PhxQueue · Tao He"/><meta property="og:type" content="website"/><meta property="og:url" content="https://taohexxx.github.io/blog/2017/09/30/phxqueue"/><meta property="og:description" content="{% include JB/setup %}"/><meta property="og:image" content="https://taohexxx.github.io/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://taohexxx.github.io/img/docusaurus.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://taohexxx.github.io/blog/atom.xml" title="Tao He Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://taohexxx.github.io/blog/feed.xml" title="Tao He Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/docusaurus.svg" alt="Tao He"/><h2 class="headerTitleWithLogo">Tao He</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/doc1" target="_self">Docs</a></li><li class=""><a href="/docs/doc4" target="_self">API</a></li><li class=""><a href="/en/help" target="_self">Help</a></li><li class="siteNavGroupActive"><a href="/blog" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Recent Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul><li class="navListItem"><a class="navItem" href="/blog/2019/01/13/microsoft-powerpoint">Microsoft PowerPoint</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/12/12/chrome">Chrome</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/11/21/alfred">Alfred</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/09/01/docusaurus">Docusaurus</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/08/30/git-commands">Git Commands</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2017/09/30/phxqueue">PhxQueue</a></h1><p class="post-meta">September 30, 2017</p><div class="authorBlock"></div></header><div><span><p>{% include JB/setup %}</p>
<h2><a class="anchor" aria-hidden="true" id="third-party-dependence"></a><a href="#third-party-dependence" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Third Party Dependence</h2>
<pre><code class="hljs css language-sh">apt-get update &amp;&amp; apt-get install -y build-essential cmake libtool python-dev libncurses-dev libreadline-dev libz-dev gdb ssh net-tools netcat tcpdump vim neovim
apt list --installed
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="gflags"></a><a href="#gflags" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gflags</h3>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> gflags-2.2.1/
mkdir cmake_build &amp;&amp; <span class="hljs-built_in">cd</span> cmake_build/
CXXFLAGS=-fPIC cmake -DCMAKE_INSTALL_PREFIX=<span class="hljs-variable">$HOME</span>/<span class="hljs-built_in">local</span> ..
make
make <span class="hljs-built_in">test</span>
make install
<span class="hljs-built_in">cd</span> -
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="google-test-170-or-older-version"></a><a href="#google-test-170-or-older-version" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Google Test (1.7.0 or Older Version)</h3>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> googletest-release-1.7.0/
vi README
g++ -isystem include -I. -pthread -c src/gtest-all.cc
ar -rv libgtest.a gtest-all.o
<span class="hljs-built_in">cd</span> -
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="google-glog"></a><a href="#google-glog" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>google-glog</h3>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> glog-0.3.5/
vi README
./autogen.sh
./configure CXXFLAGS=-fPIC --prefix=<span class="hljs-variable">$HOME</span>/<span class="hljs-built_in">local</span> --with-gflags=<span class="hljs-variable">$HOME</span>/<span class="hljs-built_in">local</span>
make
make install
<span class="hljs-built_in">cd</span> -
</code></pre>
<p>Modify log file name</p>
<p>In <code>glog\src\logging.cc</code> modify <code>LogFileObject::CreateLogfile</code></p>
<h3><a class="anchor" aria-hidden="true" id="google-mock-170-or-older-version"></a><a href="#google-mock-170-or-older-version" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Google Mock (1.7.0 or Older Version)</h3>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> googlemock-release-1.7.0/
vi README
ln -s ~/<span class="hljs-built_in">local</span>/src/googletest-release-1.7.0 gtest
autoreconf -fvi
<span class="hljs-built_in">cd</span> make/
make
<span class="hljs-built_in">cd</span> -
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="proto-buffers"></a><a href="#proto-buffers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Proto Buffers</h3>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> protobuf-3.5.1/
vi src/README
./autogen.sh
./configure CXXFLAGS=-fPIC --prefix=<span class="hljs-variable">$HOME</span>/<span class="hljs-built_in">local</span>
make
make check
make install
sudo ldconfig
<span class="hljs-built_in">cd</span> -
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="leveldb"></a><a href="#leveldb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LevelDB</h3>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> leveldb-1.20/
make
make check
ln -s out-static lib
<span class="hljs-built_in">cd</span> -
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="boost-156-version"></a><a href="#boost-156-version" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Boost (1.56 Version)</h3>
<p><a href="http://www.boost.org/">Boost</a></p>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> boost_1_56_0/
./bootstrap.sh --prefix=<span class="hljs-variable">$HOME</span>/<span class="hljs-built_in">local</span>
./b2
./b2 install
<span class="hljs-built_in">cd</span> -
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="component"></a><a href="#component" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Component</h2>
<h3><a class="anchor" aria-hidden="true" id="libco"></a><a href="#libco" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>libco</h3>
<pre><code class="hljs css language-sh">git <span class="hljs-built_in">clone</span> https://github.com/Tencent/libco.git
<span class="hljs-built_in">cd</span> libco/
make
<span class="hljs-built_in">cd</span> -
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="phxpaxos"></a><a href="#phxpaxos" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PhxPaxos</h3>
<pre><code class="hljs css language-sh">git <span class="hljs-built_in">clone</span> https://github.com/Tencent/phxpaxos.git
<span class="hljs-built_in">pushd</span> .
<span class="hljs-built_in">cd</span> phxpaxos/

rm -r third_party/gflags/
rm -r third_party/glog/
rm -r third_party/gmock/
rm -r third_party/protobuf/
rm -r third_party/leveldb/
ln -s ~/<span class="hljs-built_in">local</span> third_party/gflags
ln -s ~/<span class="hljs-built_in">local</span> third_party/glog
ln -s ~/<span class="hljs-built_in">local</span>/src/googlemock-release-1.7.0 third_party/gmock
ln -s ~/<span class="hljs-built_in">local</span> third_party/protobuf
ln -s ~/<span class="hljs-built_in">local</span>/src/leveldb-1.20 third_party/leveldb

./autoinstall.sh
make
make install
<span class="hljs-built_in">cd</span> plugin/
make
make install

<span class="hljs-built_in">popd</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="phxrpc"></a><a href="#phxrpc" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PhxRPC</h3>
<pre><code class="hljs css language-sh">git <span class="hljs-built_in">clone</span> https://github.com/Tencent/phxrpc.git
<span class="hljs-built_in">cd</span> phxrpc/

mkdir third_party
ln -s ~/<span class="hljs-built_in">local</span> third_party/boost
ln -s ~/<span class="hljs-built_in">local</span> third_party/protobuf

<span class="hljs-built_in">cd</span> -
</code></pre>
<p>build debug</p>
<pre><code class="hljs css language-sh">make debug=y
make boost debug=y
</code></pre>
<p>or add <code>debug = y</code> to <code>phxrpc.mk</code> then <code>make</code></p>
<pre><code class="hljs css language-sh"><span class="hljs-built_in">cd</span> sample/
LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span>:<span class="hljs-variable">$HOME</span>/<span class="hljs-built_in">local</span>/boost/stage/lib ./search_main -c search_server.conf
LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span>:<span class="hljs-variable">$HOME</span>/<span class="hljs-built_in">local</span>/boost/stage/lib ./search_tool_main -c search_client.conf -f PhxMqttPublish -s <span class="hljs-string">"test213"</span>
LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span>:<span class="hljs-variable">$HOME</span>/<span class="hljs-built_in">local</span>/boost/stage/lib ./search_tool_main -c search_client.conf -f PhxEcho -s <span class="hljs-string">"test456"</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="phxsql"></a><a href="#phxsql" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PhxSQL</h3>
<p>Download <a href="https://www.percona.com/downloads/Percona-Server-5.6/Percona-Server-5.6.31-77.0/source/tarball/percona-server-5.6.31-77.0.tar.gz">percona-server-5.6.31-77.0.tar.gz</a></p>
<p><strong>MUST</strong> extract to <code>phxsql/percona</code>. <code>ln -s</code> is not allowed.</p>
<pre><code class="hljs css language-sh">sudo apt-get install cmake libncurses-dev libreadline-dev libz-dev

git <span class="hljs-built_in">clone</span> https://github.com/Tencent/phxsql.git
<span class="hljs-built_in">cd</span> phxsql/

rm -r third_party/gflags/
rm -r third_party/glog/
rm -r third_party/protobuf/
rm -r third_party/leveldb/
ln -s ~/<span class="hljs-built_in">local</span> third_party/gflags
ln -s ~/<span class="hljs-built_in">local</span> third_party/glog
ln -s ~/<span class="hljs-built_in">local</span> third_party/protobuf
ln -s ~/<span class="hljs-built_in">local</span>/src/leveldb-1.20 third_party/leveldb

rm -r third_party/colib/
rm -r third_party/phxpaxos/
rm -r third_party/phxrpc/
ln -s ~/<span class="hljs-built_in">local</span>/src/libco third_party/colib
ln -s ~/<span class="hljs-built_in">local</span>/src/phxpaxos third_party/
ln -s ~/<span class="hljs-built_in">local</span>/src/phxrpc third_party/

./autoinstall.sh

<span class="hljs-comment"># percona may require link `libz.so`, `libz.a` to `libzlib.so`, `libzlib.a`</span>

sudo apt-get install libz-dev
sudo apt-get install apt-file
apt-file update
apt-file list libz-dev

<span class="hljs-built_in">cd</span> /usr/lib/x86_64-linux-gnu/
sudo ln -s libz.so libzlib.so
sudo ln -s libz.a libzlib.a

make

<span class="hljs-comment"># if percona has compile error cause by -Werror=implicit-fallthrough=, -Werror=nonnull-compare, -Wimplicit-fallthrough</span>
<span class="hljs-comment"># just comment out these lines</span>

make install
make package

<span class="hljs-built_in">cd</span> -
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="phxqueue"></a><a href="#phxqueue" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PhxQueue</h3>
<pre><code class="hljs css language-sh">git <span class="hljs-built_in">clone</span> https://github.com/Tencent/phxqueue.git
<span class="hljs-built_in">cd</span> phxqueue/

rm -r third_party/gflags/
rm -r third_party/glog/
rm -r third_party/protobuf/
rm -r third_party/leveldb/
ln -s ~/<span class="hljs-built_in">local</span> third_party/gflags
ln -s ~/<span class="hljs-built_in">local</span> third_party/glog
ln -s ~/<span class="hljs-built_in">local</span> third_party/protobuf
ln -s ~/<span class="hljs-built_in">local</span>/src/leveldb-1.20 third_party/leveldb

rm -r third_party/colib/
rm -r third_party/phxpaxos/
rm -r third_party/phxrpc/
ln -s ~/<span class="hljs-built_in">local</span>/src/libco third_party/colib
ln -s ~/<span class="hljs-built_in">local</span>/src/phxpaxos third_party/
ln -s ~/<span class="hljs-built_in">local</span>/src/phxrpc third_party/

make debug=y
make install

<span class="hljs-built_in">cd</span> -
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="docker"></a><a href="#docker" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker</h2>
<pre><code class="hljs css language-sh">docker pull buildpack-deps:artful
docker run -it -w /phx -v ~/phx:/phx -p 1883:1883 --name=phx_1 --<span class="hljs-built_in">cap</span>-add=SYS_PTRACE --security-opt seccomp=unconfined phx
docker cp test_file IMAGE_NAME:/test_directory
docker port phx_1 1883
nc -p 1883 -l -vv
</code></pre>
<p>Test connection from macOS</p>
<pre><code class="hljs css language-sh">nc localhost 1883 -v
</code></pre>
<p>Change <code>[EventLoopServer]</code>: <code>BindIP</code> in <code>mqttbroker_server.conf</code> to real ip address. Don't use <code>127.0.0.1</code>!</p>
<pre><code class="hljs css language-sh">./mqttbroker_main -c mqttbroker_server.conf
</code></pre>
<p><a href="https://stackoverflow.com/questions/35860527/warning-error-disabling-address-space-randomization-operation-not-permitted">warning: Error disabling address space randomization: Operation not permitted
</a></p>
<pre><code class="hljs css language-sh">apt-get update
apt-get install -y cmake --no-install-recommends
apt-get install python-dev
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="submodule"></a><a href="#submodule" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Submodule</h2>
<h3><a class="anchor" aria-hidden="true" id="submodule-overview"></a><a href="#submodule-overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Submodule Overview</h3>
<pre><code class="hljs css language-sh">git submodule
</code></pre>
<p>if has <code>-</code> before commit id: has not been checked out</p>
<h3><a class="anchor" aria-hidden="true" id="add-submodule"></a><a href="#add-submodule" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add Submodule</h3>
<pre><code class="hljs css language-sh">git submodule add https://github.com/gflags/gflags third_party/gflags
git submodule add https://github.com/google/glog third_party/glog
git submodule add https://github.com/google/protobuf third_party/protobuf
git submodule add https://github.com/google/leveldb third_party/leveldb
git submodule add https://github.com/google/googlemock third_party/gmock

git submodule add https://github.com/taohexxx/phxrpc third_party/phxrpc
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="remove-submodule"></a><a href="#remove-submodule" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Remove Submodule</h3>
<pre><code class="hljs css language-sh">git submodule deinit -f -- third_party/glog
rm -rf .git/modules/third_party/glog
git rm -f third_party/glog

git submodule deinit -f -- third_party/phxrpc
rm -rf .git/modules/third_party/phxrpc
git rm -f third_party/phxrpc
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="change-submodule-version"></a><a href="#change-submodule-version" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Change Submodule Version</h3>
<pre><code class="hljs css language-sh">git submodule update --init --recursive
<span class="hljs-built_in">cd</span> third_party/glog
git checkout v0.3.5  <span class="hljs-comment"># if Detached HEAD, never mind</span>
git status
git add third_party/glog
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="branch"></a><a href="#branch" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Branch</h2>
<h3><a class="anchor" aria-hidden="true" id="branch-overview"></a><a href="#branch-overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Branch Overview</h3>
<pre><code class="hljs css language-sh"><span class="hljs-comment"># show tracking branch</span>
git branch -vv
<span class="hljs-comment"># show all branch</span>
git branch -a
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="merge"></a><a href="#merge" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Merge</h2>
<h3><a class="anchor" aria-hidden="true" id="rebase-remote-branch"></a><a href="#rebase-remote-branch" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rebase remote branch</h3>
<pre><code class="hljs css language-sh">git fetch tencent
git co tencent_master
git rebase tencent/master
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="cherry-pick"></a><a href="#cherry-pick" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cherry-pick</h2>
<pre><code class="hljs css language-sh">git cherry-pick &lt;commit&gt;
</code></pre>
<p><a href="http://jaskey.github.io/blog/2015/12/22/git-cherry-pick/">http://jaskey.github.io/blog/2015/12/22/git-cherry-pick/</a></p>
<h2><a class="anchor" aria-hidden="true" id="日志文件加载查问题"></a><a href="#日志文件加载查问题" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>日志文件加载查问题</h2>
<p><code>phxqueue/phxqueue_phxrpc/plugin/configfactory.cpp</code></p>
<p><code>impl_-&gt;global_config_path</code>为global配置文件路径</p>
</span></div></div><div class="blogSocialSection"></div></div><div class="blog-recent"><a class="button" href="/blog">Recent Posts</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#third-party-dependence">Third Party Dependence</a><ul class="toc-headings"><li><a href="#gflags">gflags</a></li><li><a href="#google-test-170-or-older-version">Google Test (1.7.0 or Older Version)</a></li><li><a href="#google-glog">google-glog</a></li><li><a href="#google-mock-170-or-older-version">Google Mock (1.7.0 or Older Version)</a></li><li><a href="#proto-buffers">Proto Buffers</a></li><li><a href="#leveldb">LevelDB</a></li><li><a href="#boost-156-version">Boost (1.56 Version)</a></li></ul></li><li><a href="#component">Component</a><ul class="toc-headings"><li><a href="#libco">libco</a></li><li><a href="#phxpaxos">PhxPaxos</a></li><li><a href="#phxrpc">PhxRPC</a></li><li><a href="#phxsql">PhxSQL</a></li><li><a href="#phxqueue">PhxQueue</a></li></ul></li><li><a href="#docker">Docker</a></li><li><a href="#submodule">Submodule</a><ul class="toc-headings"><li><a href="#submodule-overview">Submodule Overview</a></li><li><a href="#add-submodule">Add Submodule</a></li><li><a href="#remove-submodule">Remove Submodule</a></li><li><a href="#change-submodule-version">Change Submodule Version</a></li></ul></li><li><a href="#branch">Branch</a><ul class="toc-headings"><li><a href="#branch-overview">Branch Overview</a></li></ul></li><li><a href="#merge">Merge</a><ul class="toc-headings"><li><a href="#rebase-remote-branch">rebase remote branch</a></li></ul></li><li><a href="#cherry-pick">cherry-pick</a></li><li><a href="#日志文件加载查问题">日志文件加载查问题</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/docusaurus.svg" alt="Tao He" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/docs/en/doc2.html">Guides (or other categories)</a><a href="/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Your Name or Your Company Name</section></footer></div></body></html>